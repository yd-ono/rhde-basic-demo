---
- name: Deploy application on microshift
  hosts: all
  tasks:
    - name: Deploy application
      vars:
        microshift_image_pull_secret: "{{ lookup('file', '~/pull-secret.txt') }}"
        microshift_app_manifests:
          - ./argocd/kustomization
          - ./argocd/namespace
          - ./argocd/argocd-crd
          - ./argocd/argocd-clusterrolebinding
          - ./argocd/argocd-rolebinding
          - ./argocd/argocd-cluster
          - ./argocd/argocd-application
          - ./argocd/argocd-apps
      ansible.builtin.import_role:
        name: edge.microshift.app

    - name: Restart service microshift service
      service:
        name: microshift
        state: restarted