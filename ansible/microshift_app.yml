---
- name: Deploy application on microshift
  hosts: all
  tasks:
    - name: Deploy application
      vars:
        microshift_image_pull_secret: "{{ lookup('file', '~/pull-secret.txt') }}"
        microshift_app_manifests:
          - ./argocd/kustomization.yaml
          - ./argocd/namespace.yaml
          - ./argocd/argocd-crd.yaml
          - ./argocd/argocd-clusterrolebinding.yaml
          - ./argocd/argocd-rolebinding.yaml
          - ./argocd/argocd-cluster.yaml
          - ./argocd/argocd-application.yaml
          - ./argocd/argocd-apps.yaml
      ansible.builtin.import_role:
        name: edge.microshift.app

    - name: Restart service microshift service
      service:
        name: microshift
        state: restarted